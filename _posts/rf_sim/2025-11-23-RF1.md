---
title: "251124 Random Forest Simulation (1)"
show_date: true
comments: true
layout: single
categories:
  - RF
tags:
  - RF
toc: true
toc_sticky: true
published: true
mathjax: true
use_math: true
---

###  Impact of noise and &sigma; (2d)
![2D Impact](/assets/rf_sim/251123_2d_impact_noise_and_sigma.png){: .align-center width="100%"}

---
<h5>1. noise X의 증가에 따른 최적점의 변경</h5>
<ol> 
  <li> &sigma; = 1인 경우에 대해, 첫 번째 열(noise X = 0인 경우)를 살펴보면, (column subsample ratio) = 1.0, (row subsample ratio) = 0.9일 때의 성과가 가장 좋은 것으로 나타남. </li>
  <li> &sigma; > 1인 경우에, 첫 번째에서 서술한 관계가 성립하지 않으며, 최적점은 (column subsample ratio) = [0.4, 0.6], (row subsample ratio) = [0.3, 0.5] 사이에서 나타나는 것으로 보임. </li>
    <ul> - &sigma; = [3, 5, 7], (noise X의 갯수) > 5 이상인 경우에서 이러한 경향이 나타남. </ul>
    <ul> - Large dimension setting에서 데이터와 변수를 모두 사용하는 것이 아닌, 일부만을 사용하는 것이 낫다는 방증으로 판단</ul>
      <ul> a. 데이터를 일부 사용하여 Tree의 &rho;를 낮추어, <b>Forest의 quality 를 높이고</b>,  </ul>
      <ul> b. noisy한 상황에서는 일부 변수만을 사용하여 overfitting의 문제를 줄여 <b>Tree의 quality 를 높이는 것</b>이 중요하다고 판단됨 </ul>
</ol>

---
###  Impact of noise and &sigma; (3d)
{% include rf_sim/251123_3d_impact_noise_and_sigma.html %}{:, .align-center}

<ol>
  <li> 위의 2d 그림을 3d로 살펴보면 다음과 같으며, 공간 상의 문제로 <b>noise X = 0개</b>, <b>noise X = 20개</b>인 상황만 가져옴. </li>
  <li> 3d 그림을 통해서 알 수 있듯이, &sigma;가 커질수록, 그리고 noisy X가 증가함에 따라 가운데 영역(적당한 column subsampling, row subsampling)의 RRMSE가 가장 낮은 것을 알 수 있음. </li>
</ol>

---
###  Generalization gap의 확인
- 모델의 Overfitting 혹은 Underfitting 여부를 체크하는 작업이 필요.
- In-sample vs Out-of sample performance의 차이를 살펴볼 필요가 있음(이하 `Generalization Gap`).
- 이는 다음과 같은 수식으로 살펴봄: $$(gap) = RRMSE_{OOS} - RRMSE_{IS}$$
- **해석 기준:**
  1.  **Overfitting:** Gap이 양수로 매우 큰 경우 ($$Gap \gg 0$$). 모델이 학습 데이터에만 과도하게 맞춰져 있음을 의미.
  2.  **Underfitting:** Gap의 크기와 무관하게, $$RRMSE_{IS}$$와 $$RRMSE_{OOS}$$의 절대적인 수치가 모두 높은 경우. 모델이 데이터의 패턴을 전혀 학습하지 못함을 의미.
  3.  **Ideal Case:** Gap이 0에 가깝거나, 강한 Regularization(Subsampling 등)으로 인해 약간의 음수($$Gap \le 0$$)를 띠면서 **RRMSE 수치 자체가 낮은 경우**.

![Generalization gap](/assets/rf_sim/251123_generalization_gap.png){: .align-center width="100%"}

- **결과 해석: Generalization Gap의 시각화 분석**

위의 Generalization Gap 히트맵과 앞서 살펴본 RRMSE 성능 지표를 교차 검증하면, **Double Subsampling**의 효용을 명확히 확인가능
<ol>
  <li> 낮은 노이즈 환경 (&sigma;=1): Overfitting의 제어</li>
    <ul>- 현상: 상단 행(&sigma;=1)을 보면, 전체적으로 <b>붉은색(\(Gap > 0\))</b>이 지배적. 특히 Noise Variables가 많아질수록(우측 열) 붉은색이 짙어지는 경향.</ul>
    <ul>- 해석: 이는 전형적인 <b>overfitting</b>을 의미: 학습 에러(\(RRMSE_{IS}\))는 매우 낮지만 테스트 에러(\(RRMSE_{OOS}\))는 상대적으로 높은 상태</ul>

  <br>
  <li> 높은 노이즈 환경 (&sigma;=9): 음수 Gap</li>

    <ul>- 현상: 하단 행(&sigma;=9)으로 갈수록 급격하게 진한 푸른색(\(Gap \ll 0\))으로 변함. 특히 우하단(Noise Vars: 20, \(sigma=9\))의 경우, 기존 방식(Row 0.9 / Col 1.0)에서 Gap이 <b>-0.103</b>에 달함. </ul>
    <ul>- 해석: 이는 학습 데이터 자체의 노이즈(&sigma;)가 너무 커서, 모델이 학습을 제대로 하지 못하고 평균값 예측으로 회귀해버린 상태로 판단(Underfitting). </ul>

  <br>
  <li> \(Gap \approx 0 \)에 가까운 지점 </li>
    <ul> - Row: 0.9, Col: 1.0 지점은 진한 파란색(\(Gap \approx -0.103\))이며, RRMSE 또한 높음. 모델이 노이즈로 인해 학습이 제대로 되지 않음. </ul>
    <ul> - Double Subsampling: Row: 0.1 ~ 0.5, Col: 0.2 ~ 0.6 지점은 색상이 흰색(\(Gap \approx 0\))에 가까움. </ul>
    <ul> - Row와 Column Subsampling을 동시에 적용했을 때, 모델이 비교적 overfitting, underfitting에서 벗어나 robust하다고 판단할 수 있음. 이는 RRMSE 히트맵에서 해당 영역이 최적 성능을 보이는 것과 일맥상통. </ul>
</ol>

  > **Summary:** Double Subsampling 전략은 노이즈가 적을 때는 과적합을 억제하고, 노이즈가 많을 때는 모델이 노이즈에 함몰되는 것을 방지하여, 모델을 robust하게 만드는 역할을 함.

---
###  (# of iterations)에 따른 RRMSE의 분포 확인
![RRMSE Distribution](/assets/rf_sim/251123_rrmse_distribution.png){: .align-center width="100%"}
<ol> 
  <li> 행 = (&sigma;), 열 = (noise X의 갯수), X축 = (column subsample ratio), y축 = (RRMSE), hue = (row subsample ratio)를 의미함. </li>
  <li> 얻을 수 있는 내용은 다음과 같음. </li>
    <ul> a. &sigma; 커질수록, 그리고 불필요한 X가 많아질수록 분포는 점점 넓어진다. </ul>
    <ul> b. &sigma; 커질수록, 그리고 불필요한 X가 많아지는 상황에서는 row subsample, column subsample ratio를 사용하여, 데이터의 일부를 사용하는 것이 도움이 된다. </ul>
        <ul> → row subsample, column subsample ratio를 일부 사용한 것의 distribution을 보면, 뚱뚱한 부분이 아래쪽에 형성되어있음. </ul>
    <ul> c. 대체적으로 column subsample ratio의 값이 0.4 또는 0.6이었을 때의 RRMSE가 가장 낮은 것으로 나타남. </ul>
</ol>

